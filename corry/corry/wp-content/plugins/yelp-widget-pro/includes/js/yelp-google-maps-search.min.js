function hex_sha1(a){return binb2hex(core_sha1(str2binb(a),a.length*chrsz))}function b64_sha1(a){return binb2b64(core_sha1(str2binb(a),a.length*chrsz))}function str_sha1(a){return binb2str(core_sha1(str2binb(a),a.length*chrsz))}function hex_hmac_sha1(a,b){return binb2hex(core_hmac_sha1(a,b))}function b64_hmac_sha1(a,b){return binb2b64(core_hmac_sha1(a,b))}function str_hmac_sha1(a,b){return binb2str(core_hmac_sha1(a,b))}function sha1_vm_test(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==hex_sha1("abc")}function core_sha1(a,b){a[b>>5]|=128<<24-b%32,a[(b+64>>9<<4)+15]=b;for(var c=Array(80),d=1732584193,e=-271733879,f=-1732584194,g=271733878,h=-1009589776,i=0;i<a.length;i+=16){for(var j=d,k=e,l=f,m=g,n=h,o=0;80>o;o++){c[o]=16>o?a[i+o]:rol(c[o-3]^c[o-8]^c[o-14]^c[o-16],1);var p=safe_add(safe_add(rol(d,5),sha1_ft(o,e,f,g)),safe_add(safe_add(h,c[o]),sha1_kt(o)));h=g,g=f,f=rol(e,30),e=d,d=p}d=safe_add(d,j),e=safe_add(e,k),f=safe_add(f,l),g=safe_add(g,m),h=safe_add(h,n)}return Array(d,e,f,g,h)}function sha1_ft(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d}function sha1_kt(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function core_hmac_sha1(a,b){var c=str2binb(a);c.length>16&&(c=core_sha1(c,a.length*chrsz));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=909522486^c[f],e[f]=1549556828^c[f];var g=core_sha1(d.concat(str2binb(b)),512+b.length*chrsz);return core_sha1(e.concat(g),672)}function safe_add(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function rol(a,b){return a<<b|a>>>32-b}function str2binb(a){for(var b=Array(),c=(1<<chrsz)-1,d=0;d<a.length*chrsz;d+=chrsz)b[d>>5]|=(a.charCodeAt(d/chrsz)&c)<<32-chrsz-d%32;return b}function binb2str(a){for(var b="",c=(1<<chrsz)-1,d=0;d<32*a.length;d+=chrsz)b+=String.fromCharCode(a[d>>5]>>>32-chrsz-d%32&c);return b}function binb2hex(a){for(var b=hexcase?"0123456789ABCDEF":"0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>8*(3-d%4)+4&15)+b.charAt(a[d>>2]>>8*(3-d%4)&15);return c}function binb2b64(a){for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="",d=0;d<4*a.length;d+=3)for(var e=(a[d>>2]>>8*(3-d%4)&255)<<16|(a[d+1>>2]>>8*(3-(d+1)%4)&255)<<8|a[d+2>>2]>>8*(3-(d+2)%4)&255,f=0;4>f;f++)c+=8*d+6*f>32*a.length?b64pad:b.charAt(e>>6*(3-f)&63);return c}function yelpMapDataInit(a,b,c){var d={consumerSecret:auth.consumerSecret,tokenSecret:auth.accessTokenSecret};parameters=[],parameters.push(["term",a]),parameters.push(["location",b]),parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",auth.consumerKey]),parameters.push(["oauth_consumer_secret",auth.consumerSecret]),parameters.push(["oauth_token",auth.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]);var e={action:"http://api.yelp.com/v2/search",method:"GET",parameters:parameters};OAuth.setTimestampAndNonce(e),OAuth.SignatureMethod.sign(e,d);var f=OAuth.getParameterMap(e.parameters);f.oauth_signature=OAuth.percentEncode(f.oauth_signature),jQuery.ajax({url:e.action,data:f,cache:!0,dataType:"jsonp",jsonpCallback:"cb",success:function(a){clearOverlays(),handleSearchResults(a,c)}})}function handleSearchResults(a,b){if(jQuery(".spinner").css("visibility","hidden"),0==a.businesses.length)return void alert("Error: No businesses were found near that location");for(var c=0;c<a.businesses.length;c++)biz=a.businesses[c],bizAddress=biz.location.address[0]+", "+biz.location.city+", "+biz.location.state_code+", "+biz.location.country_code,"undefined"!=typeof biz.location.coordinate?createSearchMarker(biz,new google.maps.LatLng(biz.location.coordinate.latitude,biz.location.coordinate.longitude),c,b):geocodeAddress(bizAddress,c,b,biz)}function geocodeAddress(a,b,c,d){geocoder.geocode({address:a},function(e,f){if(f===google.maps.GeocoderStatus.OK){var g=e[0].geometry.location.lat().toString().substr(0,12),h=e[0].geometry.location.lng().toString().substr(0,12);createSearchMarker(d,new google.maps.LatLng(g,h),b,c)}else f===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?setTimeout(function(){geocodeAddress(a,b,c,d)},200):console.log("Geocode was not successful for "+d.name+" the following reason: "+f)})}function createSearchMarker(a,b,c,d){var e=new google.maps.Marker({map:d,icon:ywpMapParams.ywpURL+"/includes/images/marker_star.png",position:b});e.content=generateSearchInfoWindowHtml(a),markersArray.push(e),google.maps.event.addListener(e,"click",function(){infowindow.setContent(e.content),infowindow.open(d,e)}),0==c&&(infowindow.setContent(e.content),infowindow.open(d,e))}function generateSearchInfoWindowHtml(a){var b='<div class="marker">';if(b+='<div class="ywp-business-top ywp-marker-block clearfix clear">',b+="undefined"!=typeof a.image_url?'<img class="businessimage" src="'+a.image_url+'" width="60" height="60" />':'<img class="businessimage" src="'+ywpMapParams.ywpURL+'/includes/images/blank-biz.png" width="60" height="60" />',b+='<div class="ywp-business-info">',b+='<a href="'+a.url+'" target="_blank" class="marker-business-name">'+a.name+"</a>",b+='<div class="review-rating"><img class="ratingsimage" src="'+a.rating_img_url_small+'"/> <span class="ywp-review-text">',b+=a.review_count+" reviews</span></div>",void 0!==a.phone){{formatPhoneNumber(a.phone)}b+='<a href="tel:'+a.phone+'" title="Call '+a.name+'" class="phone-clickable">'+a.display_phone+"</a>"}return b+="</div></div>",b+='<div class="ywp-read-review-snippet"><p class="snippet-text">'+a.snippet_text+'</p><img class="snippet-img" src="'+a.snippet_image_url+'" width="25" height="25" /></div>',b+='<div class="ywp-read-reviews"><a href="'+a.url+'" target="_blank" class="marker-business-name marker-business-link">Read the reviews Â»</a></div>',b+='<div class="businessinfo"><table border="0" class="marker-info-table" width="220" style="width:220px"><tr>',void 0!==a.categories&&(b+="<td>"+formatCategories(a.categories)+"</td>"),void 0!==a.location.neighborhoods&&(b+="<td>"+formatNeighborhoods(a.location.neighborhoods)+"</td>"),b+="<tr>",void 0!==a.location.display_address[0]&&(b+='<td colspan="2">'+formatAddress(a.location.display_address)+"</td>"),b+="</tr>",b+="</table></div></div>"}function formatCategories(a){for(var b='<div class="ywp-marker-categories-wrap ywp-marker-block"><p class="ywp-marker-cat-title"><strong>Categories:</strong></p><p class="ywp-marker-categories">',c=0;c<a.length;c++)b+='<span class="ywp-marker-cat">'+a[c][0]+"</span>",c!=a.length-1&&(b+=", ");return b+="</p></div>"}function formatNeighborhoods(a){for(var b='<div class="ywp-marker-neighborhoods-wrap ywp-marker-block"><p class="ywp-marker-neighborhoods-title"><strong>Neighborhoods:</strong></p><p class="ywp-marker-neighborhoods">',c=0;c<a.length;c++)b+='<span class="ywp-neighborhood">'+a[c]+"</span>",c!=a.length-1&&(b+=", ");return b+="</p></div>"}function formatAddress(a){output='<address class="ywp-marker-block"><strong>Address:</strong><br/><div class="ywp-map-address">';for(var b=0;b<a.length;b++)output+=a[b]+"<br>",b!=a.length-1&&(output+="");return output+="</div></address>"}function formatPhoneNumber(a){return 10!=a.length?"":"("+a.slice(0,3)+") "+a.slice(3,6)+"-"+a.slice(6,10)+"<br/>"}function clearOverlays(){for(var a=0;a<markersArray.length;a++)markersArray[a].setMap(null);markersArray=[]}var OAuth;null==OAuth&&(OAuth={}),OAuth.setProperties=function(a,b){if(null!=a&&null!=b)for(var c in b)a[c]=b[c];return a},OAuth.setProperties(OAuth,{percentEncode:function(a){if(null==a)return"";if(a instanceof Array){for(var b="",c=0;c<a.length;++a)""!=b&&(b+="&"),b+=OAuth.percentEncode(a[c]);return b}return a=encodeURIComponent(a),a=a.replace(/\!/g,"%21"),a=a.replace(/\*/g,"%2A"),a=a.replace(/\'/g,"%27"),a=a.replace(/\(/g,"%28"),a=a.replace(/\)/g,"%29")},decodePercent:function(a){return null!=a&&(a=a.replace(/\+/g," ")),decodeURIComponent(a)},getParameterList:function(a){if(null==a)return[];if("object"!=typeof a)return OAuth.decodeForm(a+"");if(a instanceof Array)return a;var b=[];for(var c in a)b.push([c,a[c]]);return b},getParameterMap:function(a){if(null==a)return{};if("object"!=typeof a)return OAuth.getParameterMap(OAuth.decodeForm(a+""));if(a instanceof Array){for(var b={},c=0;c<a.length;++c){var d=a[c][0];void 0===b[d]&&(b[d]=a[c][1])}return b}return a},getParameter:function(a,b){if(!(a instanceof Array))return OAuth.getParameterMap(a)[b];for(var c=0;c<a.length;++c)if(a[c][0]==b)return a[c][1];return null},formEncode:function(a){for(var b="",c=OAuth.getParameterList(a),d=0;d<c.length;++d){var e=c[d][1];null==e&&(e=""),""!=b&&(b+="&"),b+=OAuth.percentEncode(c[d][0])+"="+OAuth.percentEncode(e)}return b},decodeForm:function(a){for(var b=[],c=a.split("&"),d=0;d<c.length;++d){var e=c[d];if(""!=e){var f,g,h=e.indexOf("=");0>h?(f=OAuth.decodePercent(e),g=null):(f=OAuth.decodePercent(e.substring(0,h)),g=OAuth.decodePercent(e.substring(h+1))),b.push([f,g])}}return b},setParameter:function(a,b,c){var d=a.parameters;if(d instanceof Array){for(var e=0;e<d.length;++e)d[e][0]==b&&(void 0===c?d.splice(e,1):(d[e][1]=c,c=void 0));void 0!==c&&d.push([b,c])}else d=OAuth.getParameterMap(d),d[b]=c,a.parameters=d},setParameters:function(a,b){for(var c=OAuth.getParameterList(b),d=0;d<c.length;++d)OAuth.setParameter(a,c[d][0],c[d][1])},completeRequest:function(a,b){null==a.method&&(a.method="GET");var c=OAuth.getParameterMap(a.parameters);null==c.oauth_consumer_key&&OAuth.setParameter(a,"oauth_consumer_key",b.consumerKey||""),null==c.oauth_token&&null!=b.token&&OAuth.setParameter(a,"oauth_token",b.token),null==c.oauth_version&&OAuth.setParameter(a,"oauth_version","1.0"),null==c.oauth_timestamp&&OAuth.setParameter(a,"oauth_timestamp",OAuth.timestamp()),null==c.oauth_nonce&&OAuth.setParameter(a,"oauth_nonce",OAuth.nonce(6)),OAuth.SignatureMethod.sign(a,b)},setTimestampAndNonce:function(a){OAuth.setParameter(a,"oauth_timestamp",OAuth.timestamp()),OAuth.setParameter(a,"oauth_nonce",OAuth.nonce(6))},addToURL:function(a,b){if(newURL=a,null!=b){var c=OAuth.formEncode(b);if(c.length>0){var d=a.indexOf("?");newURL+=0>d?"?":"&",newURL+=c}}return newURL},getAuthorizationHeader:function(a,b){for(var c='OAuth realm="'+OAuth.percentEncode(a)+'"',d=OAuth.getParameterList(b),e=0;e<d.length;++e){var f=d[e],g=f[0];0==g.indexOf("oauth_")&&(c+=","+OAuth.percentEncode(g)+'="'+OAuth.percentEncode(f[1])+'"')}return c},correctTimestampFromSrc:function(a){a=a||"oauth_timestamp";var b=document.getElementsByTagName("script");if(null!=b&&b.length){var c=b[b.length-1].src;if(c){var d=c.indexOf("?");if(!(0>d)){parameters=OAuth.getParameterMap(OAuth.decodeForm(c.substring(d+1)));var e=parameters[a];null!=e&&OAuth.correctTimestamp(e)}}}},correctTimestamp:function(a){OAuth.timeCorrectionMsec=1e3*a-(new Date).getTime()},timeCorrectionMsec:0,timestamp:function(){var a=(new Date).getTime()+OAuth.timeCorrectionMsec;return Math.floor(a/1e3)},nonce:function(a){for(var b=OAuth.nonce.CHARS,c="",d=0;a>d;++d){var e=Math.floor(Math.random()*b.length);c+=b.substring(e,e+1)}return c}}),OAuth.nonce.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",OAuth.declareClass=function(a,b,c){var d=a[b];if(a[b]=c,null!=c&&null!=d)for(var e in d)"prototype"!=e&&(c[e]=d[e]);return c},OAuth.declareClass(OAuth,"SignatureMethod",function(){}),OAuth.setProperties(OAuth.SignatureMethod.prototype,{sign:function(a){var b=OAuth.SignatureMethod.getBaseString(a),c=this.getSignature(b);return OAuth.setParameter(a,"oauth_signature",c),c},initialize:function(a,b){var c;c=null!=b.accessorSecret&&a.length>9&&"-Accessor"==a.substring(a.length-9)?b.accessorSecret:b.consumerSecret,this.key=OAuth.percentEncode(c)+"&"+OAuth.percentEncode(b.tokenSecret)}}),OAuth.setProperties(OAuth.SignatureMethod,{sign:function(a,b){var c=OAuth.getParameterMap(a.parameters).oauth_signature_method;(null==c||""==c)&&(c="HMAC-SHA1",OAuth.setParameter(a,"oauth_signature_method",c)),OAuth.SignatureMethod.newMethod(c,b).sign(a)},newMethod:function(a,b){var c=OAuth.SignatureMethod.REGISTERED[a];if(null!=c){var d=new c;return d.initialize(a,b),d}var e=new Error("signature_method_rejected"),f="";for(var g in OAuth.SignatureMethod.REGISTERED)""!=f&&(f+="&"),f+=OAuth.percentEncode(g);throw e.oauth_acceptable_signature_methods=f,e},REGISTERED:{},registerMethodClass:function(a,b){for(var c=0;c<a.length;++c)OAuth.SignatureMethod.REGISTERED[a[c]]=b},makeSubclass:function(a){var b=OAuth.SignatureMethod,c=function(){b.call(this)};return c.prototype=new b,c.prototype.getSignature=a,c.prototype.constructor=c,c},getBaseString:function(a){var b,c=a.action,d=c.indexOf("?");if(0>d)b=a.parameters;else{b=OAuth.decodeForm(c.substring(d+1));for(var e=OAuth.getParameterList(a.parameters),f=0;f<e.length;++f)b.push(e[f])}return OAuth.percentEncode(a.method.toUpperCase())+"&"+OAuth.percentEncode(OAuth.SignatureMethod.normalizeUrl(c))+"&"+OAuth.percentEncode(OAuth.SignatureMethod.normalizeParameters(b))},normalizeUrl:function(a){var b=OAuth.SignatureMethod.parseUri(a),c=b.protocol.toLowerCase(),d=b.authority.toLowerCase(),e="http"==c&&80==b.port||"https"==c&&443==b.port;if(e){var f=d.lastIndexOf(":");f>=0&&(d=d.substring(0,f))}var g=b.path;return g||(g="/"),c+"://"+d+g},parseUri:function(a){for(var b={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},c=b.parser.strict.exec(a),d={},e=14;e--;)d[b.key[e]]=c[e]||"";return d},normalizeParameters:function(a){if(null==a)return"";for(var b=OAuth.getParameterList(a),c=[],d=0;d<b.length;++d){var e=b[d];"oauth_signature"!=e[0]&&c.push([OAuth.percentEncode(e[0])+" "+OAuth.percentEncode(e[1]),e])}c.sort(function(a,b){return a[0]<b[0]?-1:a[0]>b[0]?1:0});for(var f=[],g=0;g<c.length;++g)f.push(c[g][1]);return OAuth.formEncode(f)}}),OAuth.SignatureMethod.registerMethodClass(["PLAINTEXT","PLAINTEXT-Accessor"],OAuth.SignatureMethod.makeSubclass(function(){return this.key})),OAuth.SignatureMethod.registerMethodClass(["HMAC-SHA1","HMAC-SHA1-Accessor"],OAuth.SignatureMethod.makeSubclass(function(a){b64pad="=";var b=b64_hmac_sha1(this.key,a);return b}));try{OAuth.correctTimestampFromSrc()}catch(e){}var hexcase=0,b64pad="",chrsz=8,auth={consumerKey:ywpMapParams.consumerKey,consumerSecret:ywpMapParams.consumerSecret,accessToken:ywpMapParams.accessToken,accessTokenSecret:ywpMapParams.accessTokenSecret,serviceProvider:{signatureMethod:"HMAC-SHA1"}},map,icon,markersArray=[],infowindow=new google.maps.InfoWindow({maxWidth:220});jQuery.noConflict(),function(a){a(function(){var b=a(".yelp-map");b.each(function(c){geocoder=new google.maps.Geocoder;var d=b.parent().parent(),e=a(d).find(".yelp-search-term").attr("placeholder"),f=d.attr("data-map-location");geocoder.geocode({address:f},function(d,g){if(g==google.maps.GeocoderStatus.OK){var h=d[0].geometry.location,i=h.lat(),j=h.lng(),k={zoom:10,center:new google.maps.LatLng(i,j),mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(b[c],k),a(".yelp-search-form").on("submit",function(b){b.preventDefault();var c=a(this).children(".yelp-search-term").val();yelpMapDataInit(c,f,map)}),yelpMapDataInit(e,f,map)}else console.log("Geocode was not successful for the following reason: "+g)})})})}(jQuery);
